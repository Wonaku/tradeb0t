// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./storage.db"
}

model D_Currency {
  @@map("Currencies")

  name                String
  ticker              String  @id

  securities          D_Security[]
}

model D_Security {
  @@map("Securities")

  name                String
  ticker              String  @id
  price               Float

  currency_ticker     String 

  currency            D_Currency  @relation(fields: [currency_ticker], references: [ticker])
  followed_securities D_FollowedSecurity[]
  portfolio_positions D_PortfolioPosition[]
  transactions        D_TransactionHistoryNote[]
}

model D_FollowedSecurity {
  @@map("FollowedSecurities")

  security_ticker     String  @id
  followed_since      DateTime

  security            D_Security @relation(fields: [security_ticker], references: [ticker])
}

model D_PortfolioPosition {
  @@map("PortfolioPositions")

  security_ticker     String
  amount              Int
  buy_price           Float?
  buy_date            DateTime  @default(now())

  security            D_Security @relation(fields: [security_ticker], references: [ticker])

  @@id([security_ticker, buy_date])
}

model D_TransactionHistoryNote {
  @@map("TransactionHistoryNotes")

  security_ticker     String
  transaction_type    String
  amount              Int
  price               Float
  date                DateTime  @default(now())

  security            D_Security @relation(fields: [security_ticker], references: [ticker])

  @@id([security_ticker, date])
}